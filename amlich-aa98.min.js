var PI=Math.PI;function INT(a){return Math.floor(a)}function jdFromDate(b,c,d){var e,f,g,h;return e=INT((14-c)/12),f=d+4800-e,g=c+12*e-3,h=b+INT((153*g+2)/5)+365*f+INT(f/4)-INT(f/100)+INT(f/400)-32045,2299161>h&&(h=b+INT((153*g+2)/5)+365*f+INT(f/4)-32083),h}function jdToDate(f){var g,h,i,j,k,l,n,o,p;return 2299160<f?(g=f+32044,h=INT((4*g+3)/146097),i=g-INT(146097*h/4)):(h=0,i=f+32082),j=INT((4*i+3)/1461),k=i-INT(1461*j/4),l=INT((5*k+2)/153),n=k-INT((153*l+2)/5)+1,o=l+3-12*INT(l/10),p=100*h+j-4800+INT(l/10),[n,o,p]}function NewMoon(a){var b,c,d,e,f,g,h,i,j,k,l;return b=a/1236.85,c=b*b,d=c*b,e=PI/180,f=2415020.75933+29.53058868*a+1178e-7*c-155e-9*d,f+=33e-5*Math.sin((166.56+132.87*b-.009173*c)*e),g=359.2242+29.10535608*a-333e-7*c-347e-8*d,h=306.0253+385.81691806*a+.0107306*c+1236e-8*d,i=21.2964+390.67050646*a-.0016528*c-239e-8*d,j=(.1734-393e-6*b)*Math.sin(g*e)+.0021*Math.sin(2*e*g),j=j-.4068*Math.sin(h*e)+.0161*Math.sin(2*e*h),j-=4e-4*Math.sin(3*e*h),j=j+.0104*Math.sin(2*e*i)-.0051*Math.sin(e*(g+h)),j=j-.0074*Math.sin(e*(g-h))+4e-4*Math.sin(e*(2*i+g)),j=j-4e-4*Math.sin(e*(2*i-g))-6e-4*Math.sin(e*(2*i+h)),j=j+.001*Math.sin(e*(2*i-h))+5e-4*Math.sin(e*(2*h+g)),k=-11>b?.001+839e-6*b+2261e-7*c-845e-8*d-81e-9*b*d:-278e-6+265e-6*b+262e-6*c,(l=f+j-k,l)}function SunLongitude(a){var b,c,d,e,f,g,h;return b=(a-2451545)/36525,c=b*b,d=PI/180,e=357.5291+35999.0503*b-1559e-7*c-48e-8*b*c,f=280.46645+36000.76983*b+3032e-7*c,g=(1.9146-.004817*b-14e-6*c)*Math.sin(d*e),g=g+(.019993-101e-6*b)*Math.sin(2*d*e)+29e-5*Math.sin(3*d*e),h=f+g,h*=d,h-=2*PI*INT(h/(2*PI)),h}function getSunLongitude(a,b){return INT(6*(SunLongitude(a-.5-b/24)/PI))}function getNewMoonDay(a,b){return INT(NewMoon(a)+.5+b/24)}function getLunarMonth11(a,b){var c,d,e,f;return d=jdFromDate(31,12,a)-2415021,c=INT(d/29.530588853),e=getNewMoonDay(c,b),f=getSunLongitude(e,b),9<=f&&(e=getNewMoonDay(c-1,b)),e}function getLeapMonthOffset(a,b){var c,d,e,f;c=INT((a-2415021.076998695)/29.530588853+.5),d=0,f=1,e=getSunLongitude(getNewMoonDay(c+f,b),b);do d=e,f++,e=getSunLongitude(getNewMoonDay(c+f,b),b);while(e!=d&&14>f);return f-1}function convertSolar2Lunar(a,b,c,d){var e,f,g,h,i,j,l,m,n;return f=jdFromDate(a,b,c),e=INT((f-2415021.076998695)/29.530588853),g=getNewMoonDay(e+1,d),g>f&&(g=getNewMoonDay(e,d)),h=getLunarMonth11(c,d),i=h,h>=g?(m=c,h=getLunarMonth11(c-1,d)):(m=c+1,i=getLunarMonth11(c+1,d)),j=f-g+1,diff=INT((g-h)/29),n=0,l=diff+11,365<i-h&&(leapMonthDiff=getLeapMonthOffset(h,d),diff>=leapMonthDiff&&(l=diff+10,diff==leapMonthDiff&&(n=1))),12<l&&(l-=12),11<=l&&4>diff&&(m-=1),[j,l,m,n]}function convertLunar2Solar(a,b,c,d,e){var f,g,h,i,j,l,m;if(11>b?(g=getLunarMonth11(c-1,e),h=getLunarMonth11(c,e)):(g=getLunarMonth11(c,e),h=getLunarMonth11(c+1,e)),f=INT(.5+(g-2415021.076998695)/29.530588853),i=b-11,0>i&&(i+=12),365<h-g){if(j=getLeapMonthOffset(g,e),l=j-2,0>l&&(l+=12),0!=d&&b!=l)return[0,0,0];(0!=d||i>=j)&&(i+=1)}return m=getNewMoonDay(f+i,e),jdToDate(m+a-1)}
